# The base image is expected to contain
# /bin/opm (with a serve subcommand) and /bin/grpc_health_probe
FROM registry.redhat.io/openshift4/ose-operator-registry:v4.12

# Configure the entrypoint and command
#ENTRYPOINT ["/bin/opm"]
#CMD ["serve", "/configs"]
#CMD ["render", "image-registry.openshift-image-registry.svc:5000/service-telemetry/service-telemetry-operator-bundle:latest", "--output=yaml"]
RUN /bin/bash -c 'mkdir /tmp/auth/'
RUN /bin/bash -c 'echo "eyJhdXRocyI6eyJpbWFnZS1yZWdpc3RyeS5vcGVuc2hpZnQtaW1hZ2UtcmVnaXN0cnkuc3ZjOjUwMDAiOnsidXNlcm5hbWUiOiJzZXJ2aWNlYWNjb3VudCIsInBhc3N3b3JkIjoiZXlKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNkltUlhkRmhyTUdKNFJWVTJaMVY2UVVkM1gwMXBNa2RmV0ZaZlJteG9hemt0VkUxYWQwOTVPWFJaYUZraWZRLmV5SnBjM01pT2lKcmRXSmxjbTVsZEdWekwzTmxjblpwWTJWaFkyTnZkVzUwSWl3aWEzVmlaWEp1WlhSbGN5NXBieTl6WlhKMmFXTmxZV05qYjNWdWRDOXVZVzFsYzNCaFkyVWlPaUp6WlhKMmFXTmxMWFJsYkdWdFpYUnllU0lzSW10MVltVnlibVYwWlhNdWFXOHZjMlZ5ZG1salpXRmpZMjkxYm5RdmMyVmpjbVYwTG01aGJXVWlPaUppZFdsc1pHVnlMWFJ2YTJWdUxXcDZZbm81SWl3aWEzVmlaWEp1WlhSbGN5NXBieTl6WlhKMmFXTmxZV05qYjNWdWRDOXpaWEoyYVdObExXRmpZMjkxYm5RdWJtRnRaU0k2SW1KMWFXeGtaWElpTENKcmRXSmxjbTVsZEdWekxtbHZMM05sY25acFkyVmhZMk52ZFc1MEwzTmxjblpwWTJVdFlXTmpiM1Z1ZEM1MWFXUWlPaUptWkROak1ESXdNeTB4TXprNUxUUTRZbVF0T0dJeU15MW1PV0kyWVRNMVkyVTRaV1lpTENKemRXSWlPaUp6ZVhOMFpXMDZjMlZ5ZG1salpXRmpZMjkxYm5RNmMyVnlkbWxqWlMxMFpXeGxiV1YwY25rNlluVnBiR1JsY2lKOS5nOHdDM0ZFOVpHR0F0SG1fMTBLYmNpOUFpUG02ZzlRMlJ4OHgtYTBMenRBUlphdTNFNGxSVDNpbjdlWXJ0SWdNeTBkV3V4aGdtRU1Vc1NwRTYzOFVybld4bW5SVnp5NVFfbUY1MGVXUTk1TlJRT2Rpd3BpdzQ2US1WMElkODZYT3I1MTZBeDhIVXhWRTQ1VDNWRllVWm9sUzdlc3IxNWliX0JMcGY5R2JIUV9Vblh0NHBTNmlJNzA5TFk5WlFxR2FsUFJkR2FFX05zdldnRnBGN1RQWnFXSTdxVHNSNFk1eHM0T1NQcnViT3RMZmNkVUZRcnVxM3FSeDU4VGQxN0RQRTBubGxNazF4VExKcVU1d0JWajRTaEg0Q1pFWEtfRVh1ZFZkTUQwMUJEalpnNzBoNnNOWm5Ydm9jX25uamVaMVl2NVR2Z1lSa2I2TlpGUWhxdnpKVFpobGJFWEx5VDhpLU82LW9FeGNEbkVtZE9uNHNqMWRabkt6SFdmVVdBX0FIT1VDR1o4SUJpUTc2QThZaDBHTEhtc09aVVR4cnhYVVZUdUZ4cUNhdXlEbE9sV2FNYmREcWZtQ3gwVmY5anFfUmdoazQwSm5xaHE0anhoZDVHYkEtLWlTY3NXMGZWbUh0eHRqRUE5dlJKU0tGLXpWT3dmLUt6RjBDb0l5dkRpX2ZXT2xkc0xFenJnbUVXbVBQNUp5T0VDV1FsLU5rdjF3RkZfRk1CZXhRQVJRS3JZNm45S3MtYlgtSjZ3bzlERTBpb013LVl5aGpRTFY1T2VtWVVvMmJwejEzNGt5QnB6anduOHVTcDhnWVVVbXJBQU0zamt1WEpDZ0xCTGFVcVNWZHU5elFIZlV1MW9LX3AtRlY0WVByVmNVUHE0TlZFbXhDMnRzeVRhMU1MWSIsImVtYWlsIjoic2VydmljZWFjY291bnRAZXhhbXBsZS5vcmciLCJhdXRoIjoiYzJWeWRtbGpaV0ZqWTI5MWJuUTZaWGxLYUdKSFkybFBhVXBUVlhwSk1VNXBTWE5KYlhSd1drTkpOa2x0VWxoa1JtaHlUVWRLTkZKV1ZUSmFNVlkyVVZWa00xZ3dNWEJOYTJSbVYwWmFabEp0ZUc5aGVtdDBWa1V4WVdRd09UVlBXRkphWVVacmFXWlJMbVY1U25Cak0wMXBUMmxLY21SWFNteGpiVFZzWkVkV2Vrd3pUbXhqYmxwd1dUSldhRmt5VG5aa1Z6VXdTV2wzYVdFelZtbGFXRXAxV2xoU2JHTjVOWEJpZVRsNldsaEtNbUZYVG14WlYwNXFZak5XZFdSRE9YVlpWekZzWXpOQ2FGa3lWV2xQYVVwNldsaEtNbUZYVG14TVdGSnNZa2RXZEZwWVVubGxVMGx6U1cxME1WbHRWbmxpYlZZd1dsaE5kV0ZYT0haak1sWjVaRzFzYWxwWFJtcFpNamt4WW01UmRtTXlWbXBqYlZZd1RHMDFhR0pYVldsUGFVcHBaRmRzYzFwSFZubE1XRkoyWVRKV2RVeFhjRFpaYm04MVNXbDNhV0V6Vm1sYVdFcDFXbGhTYkdONU5YQmllVGw2V2xoS01tRlhUbXhaVjA1cVlqTldkV1JET1hwYVdFb3lZVmRPYkV4WFJtcFpNamt4WW01UmRXSnRSblJhVTBrMlNXMUtNV0ZYZUd0YVdFbHBURU5LY21SWFNteGpiVFZzWkVkV2VreHRiSFpNTTA1c1kyNWFjRmt5Vm1oWk1rNTJaRmMxTUV3elRteGpibHB3V1RKVmRGbFhUbXBpTTFaMVpFTTFNV0ZYVVdsUGFVcHRXa1JPYWsxRVNYZE5lVEI0VFhwck5VeFVVVFJaYlZGMFQwZEplVTE1TVcxUFYwa3lXVlJOTVZreVZUUmFWMWxwVEVOS2VtUlhTV2xQYVVwNlpWaE9NRnBYTURaak1sWjVaRzFzYWxwWFJtcFpNamt4WW01Uk5tTXlWbmxrYld4cVdsTXhNRnBYZUd4aVYxWXdZMjVyTmxsdVZuQmlSMUpzWTJsS09TNW5PSGRETTBaRk9WcEhSMEYwU0cxZk1UQkxZbU5wT1VGcFVHMDJaemxSTWxKNE9IZ3RZVEJNZW5SQlVscGhkVE5GTkd4U1ZETnBiamRsV1hKMFNXZE5lVEJrVjNWNGFHZHRSVTFWYzFOd1JUWXpPRlZ5YmxkNGJXNVNWbnA1TlZGZmJVWTFNR1ZYVVRrMVRsSlJUMlJwZDNCcGR6UTJVUzFXTUVsa09EWllUM0kxTVRaQmVEaElWWGhXUlRRMVZETldSbGxWV205c1V6ZGxjM0l4TldsaVgwSk1jR1k1UjJKSVVWOVZibGgwTkhCVE5tbEpOekE1VEZrNVdsRnhSMkZzVUZKa1IyRkZYMDV6ZGxkblJuQkdOMVJRV25GWFNUZHhWSE5TTkZrMWVITTBUMU5RY25WaVQzUk1abU5rVlVaUmNuVnhNM0ZTZURVNFZHUXhOMFJRUlRCdWJHeE5hekY0VkV4S2NWVTFkMEpXYWpSVGFFZzBRMXBGV0V0ZlJWaDFaRlprVFVRd01VSkVhbHBuTnpCb05uTk9XbTVZZG05algyNXVhbVZhTVZsMk5WUjJaMWxTYTJJMlRscEdVV2h4ZG5wS1ZGcG9iR0pGV0V4NVZEaHBMVTgyTFc5RmVHTkVia1Z0WkU5dU5ITnFNV1JhYmt0NlNGZG1WVmRCWDBGSVQxVkRSMW80U1VKcFVUYzJRVGhaYURCSFRFaHRjMDlhVlZSNGNuaFlWVlpVZFVaNGNVTmhkWGxFYkU5c1YyRk5ZbVJFY1dadFEzZ3dWbVk1YW5GZlVtZG9helF3U201eGFIRTBhbmhvWkRWSFlrRXRMV2xUWTNOWE1HWldiVWgwZUhScVJVRTVkbEpLVTB0R0xYcFdUM2RtTFV0NlJqQkRiMGw1ZGtScFgyWlhUMnhrYzB4RmVuSm5iVVZYYlZCUU5VcDVUMFZEVjFGc0xVNXJkakYzUmtaZlJrMUNaWGhSUVZKUlMzSlpObTQ1UzNNdFlsZ3RTalozYnpsRVJUQnBiMDEzTFZsNWFHcFJURlkxVDJWdFdWVnZNbUp3ZWpFek5HdDVRbkI2YW5kdU9IVlRjRGhuV1ZWVmJYSkJRVTB6YW10MVdFcERaMHhDVEdGVmNWTldaSFU1ZWxGSVpsVjFNVzlMWDNBdFJsWTBXVkJ5Vm1OVlVIRTBUbFpGYlhoRE1uUnplVlJoTVUxTVdRPT0ifX19Cg==" | base64 -d | tee /tmp/auth/config.json'
RUN cat /tmp/auth/config.json
RUN echo $(DOCKER_CONFIG=/tmp/auth/ /bin/opm --skip-tls-verify render image-registry.openshift-image-registry.svc:5000/service-telemetry/service-telemetry-operator-bundle:latest --output=yaml)

# Copy declarative config root into image at /configs
#ADD service-telemetry-operator-index /configs

# Set DC-specific label for the location of the DC root directory
# in the image
LABEL operators.operatorframework.io.index.configs.v1=/configs


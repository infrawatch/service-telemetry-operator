- name: Build events SmartGateway name
  set_fact:
    this_smartgateway: "{{ meta.name }}-{{ this_cloud.name }}-{{ this_collector.collector_type }}-notification"
  when: data_type == "events"

- name: Build metrics SmartGateway name
  set_fact:
    this_smartgateway: "{{ meta.name }}-{{ this_cloud.name }}-{{ this_collector.collector_type }}-telemetry"
  when: data_type == "metrics"

- name: Append Smart Gateway to list of SGs
  set_fact:
    smartgateway_list: "{{ smartgateway_list }} + [ '{{ this_smartgateway }}' ]"

- name: Deploy instance of Smart Gateway
  k8s:
    definition: "{{ lookup('template', manifest) | from_yaml }}"

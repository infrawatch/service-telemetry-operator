- name: Lookup template
  debug:
    msg: "{{ lookup('template', './manifest_alertmanager.j2') | from_yaml }}"

- name: Set default Alertmanager manifest
  set_fact:
    alertmanager_manifest: "{{ lookup('template', './manifest_alertmanager.j2') | from_yaml }}"
  when: alertmanager_manifest is not defined

- name: Lookup alertmanager configuration template
  debug:
    msg: "{{ lookup('template', './manifest_alertmanager_config.j2') | from_yaml }}"

- name: Set default Alertmanager configuration manifest
  set_fact:
    alertmanager_config_manifest: "{{ lookup('template', './manifest_alertmanager_config.j2') | from_yaml }}"
  when: alertmanager_config_manifest is not defined

- name: Create an Alertmanager configuration secret
  k8s:
    definition:
      '{{ alertmanager_config_manifest }}'

- name: Create an instance of Alertmanager
  k8s:
    definition:
      '{{ alertmanager_manifest }}'
# TODO: Create route to access Alertmanager (conditional, default off)

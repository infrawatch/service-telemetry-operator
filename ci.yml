global:
  timeout: 2400
  env:
    OCP_PROJECT: __commit__
    THIS_BRANCH: __branch__
script:
  - oc new-project "${OCP_PROJECT}"
  - ansible-playbook --extra-vars working_namespace="${OCP_PROJECT}" --extra-vars working_branch="${THIS_BRANCH}" build/run-ci.yaml
  - ./tests/smoketest/smoketest.sh
after_script:
  - echo Final State; echo
  - oc get pods
  - echo
  - cd working/smart-gateway ; git reset --hard HEAD
  - cd working/smart-gateway-operator ; git reset --hard HEAD
  - ./deploy/containerlogs.sh
  - ./deploy/remove_stf.sh

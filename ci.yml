global:
  timeout: 2400
  env:
    OCP_PROJECT: __commit__
    THIS_BRANCH: __branch__
script:
  - oc new-project "${OCP_PROJECT}"
  - echo "Current working directory is $(pwd)"
  - ls -lah ; ls -lah build
  - ansible-playbook --extra-vars working_namespace="${OCP_PROJECT}" --extra-vars working_branch="${THIS_BRANCH}" build/run-ci.yml
after_script:
  - echo Final State; echo
  - oc get pods
  - echo
  - ./deploy/containerlogs.sh
  - ./deploy/remove_stf.sh
  - rm -rf /tmp/smart-gateway-operator ; rm -rf /tmp/smart-gateway
